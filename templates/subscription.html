{% extends "simple_base.html" %}

{% block title %}Subscription - CalculatenTrade{% endblock %}

{% block content %}
<style>
@keyframes float {
    0%, 100% { transform: translateY(0px) rotate(0deg); }
    50% { transform: translateY(-20px) rotate(5deg); }
}
@keyframes glow {
    0%, 100% { opacity: 0.5; }
    50% { opacity: 1; }
}
@keyframes shimmer {
    0% { background-position: -1000px 0; }
    100% { background-position: 1000px 0; }
}
@keyframes pulse-border {
    0%, 100% { box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.4); }
    50% { box-shadow: 0 0 0 10px rgba(34, 197, 94, 0); }
}
@keyframes fadeInUp {
    from { opacity: 0; transform: translateY(30px); }
    to { opacity: 1; transform: translateY(0); }
}
@keyframes scaleIn {
    from { opacity: 0; transform: scale(0.95); }
    to { opacity: 1; transform: scale(1); }
}
.glass-effect {
    background: rgba(15, 23, 42, 0.6);
    backdrop-filter: blur(20px);
    border: 1px solid rgba(255, 255, 255, 0.1);
}
.hover-lift {
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}
.hover-lift:hover {
    transform: translateY(-8px) scale(1.02);
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
}
.animate-float { animation: float 6s ease-in-out infinite; }
.animate-glow { animation: glow 3s ease-in-out infinite; }
.animate-shimmer {
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
    background-size: 1000px 100%;
    animation: shimmer 3s infinite;
}
.animate-pulse-border { animation: pulse-border 2s infinite; }
.animate-fade-in-up { animation: fadeInUp 0.8s ease-out; }
.animate-scale-in { animation: scaleIn 0.6s ease-out; }
</style>

<main class="relative max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 sm:py-12 lg:py-16 overflow-hidden">
    <!-- Animated Background -->
    <div class="absolute inset-0 -z-10 overflow-hidden">
        <div class="absolute inset-0 bg-[linear-gradient(to_right,#1e293b_1px,transparent_1px),linear-gradient(to_bottom,#1e293b_1px,transparent_1px)] bg-[size:4rem_4rem] [mask-image:radial-gradient(ellipse_80%_50%_at_50%_0%,#000_70%,transparent_110%)] opacity-20"></div>
        <div class="absolute -top-40 -right-32 w-80 h-80 bg-gradient-to-r from-blue-400/20 to-cyan-400/20 rounded-full blur-3xl animate-pulse animate-glow"></div>
        <div class="absolute top-1/2 -left-32 w-96 h-96 bg-gradient-to-r from-green-400/20 to-emerald-400/20 rounded-full blur-3xl animate-pulse animate-glow" style="animation-delay: 1s;"></div>
        <div class="absolute -bottom-32 right-1/4 w-64 h-64 bg-gradient-to-r from-purple-400/20 to-pink-400/20 rounded-full blur-3xl animate-pulse animate-glow" style="animation-delay: 2s;"></div>
    </div>

    <div class="text-center mb-8 sm:mb-12 lg:mb-16 animate-fade-in-up">
        <div class="inline-flex items-center gap-2 px-4 py-2 rounded-full glass-effect text-sm text-slate-300 mb-4 hover:scale-105 transition-transform cursor-pointer">
            <svg class="w-4 h-4 text-amber-400 animate-pulse" fill="currentColor" viewBox="0 0 20 20">
                <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
            </svg>
            <span>Premium Plans</span>
        </div>
        <h1 class="text-2xl sm:text-3xl lg:text-4xl xl:text-5xl font-bold text-white mb-3 sm:mb-4" style="background: linear-gradient(135deg, #60a5fa 0%, #34d399 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; filter: drop-shadow(0 0 20px rgba(56, 189, 248, 0.3));">Choose Your Plan</h1>
        {% if user and user.has_active_subscription() %}
        <div class="inline-flex items-center gap-2 px-6 py-3 rounded-xl glass-effect border border-green-500/50 text-green-300 mb-6 animate-pulse-border hover:scale-105 transition-transform">
            <svg class="w-5 h-5 animate-pulse" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
            </svg>
            <span class="font-semibold">Premium Active - {{ user.subscription_type }} plan until {{ user.subscription_expires.strftime('%B %d, %Y') if user.subscription_expires else 'Lifetime' }}</span>
        </div>
        {% else %}
        <p class="text-slate-300 text-base sm:text-lg mb-6 sm:mb-8 max-w-2xl mx-auto px-4">Select the plan that best fits your trading needs and unlock premium features.</p>
        {% endif %}
    </div>

    {% if not user or not user.has_active_subscription() %}
    <!-- Pricing Plans -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 sm:gap-8 max-w-5xl mx-auto">
        <!-- Monthly Plan -->
        <div class="relative overflow-hidden rounded-xl sm:rounded-2xl glass-effect border border-slate-700 p-4 sm:p-6 lg:p-8 hover:border-blue-500/50 transition-all hover-lift animate-scale-in group" data-plan="monthly">
            <!-- Animated Background Glow -->
            <div class="absolute -top-24 -right-24 w-48 h-48 bg-gradient-to-r from-blue-600/20 to-cyan-500/20 rounded-full blur-3xl group-hover:scale-150 transition-transform duration-700 animate-glow"></div>
            <div class="text-center relative z-10">
                <div class="inline-flex items-center gap-2 px-3 py-1 rounded-full glass-effect text-xs text-blue-300 mb-3 border border-blue-500/30">
                    <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M10 2a6 6 0 00-6 6v3.586l-.707.707A1 1 0 004 14h12a1 1 0 00.707-1.707L16 11.586V8a6 6 0 00-6-6zM10 18a3 3 0 01-3-3h6a3 3 0 01-3 3z"/>
                    </svg>
                    <span>Flexible Monthly</span>
                </div>
                <h3 class="text-xl sm:text-2xl font-bold text-white mb-2 group-hover:scale-105 transition-transform">Monthly Plan</h3>
                <div class="text-3xl sm:text-4xl font-bold text-blue-400 mb-4 sm:mb-6 group-hover:scale-110 transition-transform" style="filter: drop-shadow(0 0 10px rgba(59, 130, 246, 0.5));">â‚¹300<span class="text-base sm:text-lg text-slate-400">/month</span></div>
                
                <ul class="text-left space-y-2 sm:space-y-3 mb-6 sm:mb-8">
                    <li class="flex items-center gap-2 sm:gap-3 text-slate-300">
                        <svg class="w-4 h-4 sm:w-5 sm:h-5 text-green-400 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                        </svg>
                        <span class="text-sm sm:text-base">All Trading Calculators</span>
                    </li>
                    <li class="flex items-center gap-2 sm:gap-3 text-slate-300">
                        <svg class="w-4 h-4 sm:w-5 sm:h-5 text-green-400 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                        </svg>
                        <span class="text-sm sm:text-base">Position Management & Risk Analysis</span>
                    </li>
                    <li class="flex items-center gap-2 sm:gap-3 text-slate-300">
                        <svg class="w-4 h-4 sm:w-5 sm:h-5 text-green-400 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                        </svg>
                        <span class="text-sm sm:text-base">Trade Journal & Analytics</span>
                    </li>
                    <li class="flex items-center gap-2 sm:gap-3 text-slate-300">
                        <svg class="w-4 h-4 sm:w-5 sm:h-5 text-green-400 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                        </svg>
                        <span class="text-sm sm:text-base">Real-time Market Data</span>
                    </li>
                    <li class="flex items-center gap-2 sm:gap-3 text-slate-300">
                        <svg class="w-4 h-4 sm:w-5 sm:h-5 text-green-400 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                        </svg>
                        <span class="text-sm sm:text-base">Email Support</span>
                    </li>
                </ul>
                
                <div class="mb-4 sm:mb-6">
                    <div class="relative">
                        <input type="text" id="monthly-coupon" class="w-full px-3 sm:px-4 py-2.5 sm:py-3 rounded-lg glass-effect border border-slate-600 text-white placeholder-slate-400 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/50 transition-all text-sm sm:text-base" placeholder="Enter coupon code (optional)">
                        <svg class="absolute right-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-slate-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 5v2m0 4v2m0 4v2M5 5a2 2 0 00-2 2v3a2 2 0 110 4v3a2 2 0 002 2h14a2 2 0 002-2v-3a2 2 0 110-4V7a2 2 0 00-2-2H5z"/>
                        </svg>
                    </div>
                    <button type="button" class="mt-2 sm:mt-3 px-3 sm:px-4 py-2 rounded-lg glass-effect text-slate-300 hover:bg-blue-500/20 hover:text-blue-300 hover:border-blue-500/50 transition-all text-sm sm:text-base border border-slate-600" onclick="applyCoupon('monthly')">
                        <span class="flex items-center gap-2">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                            </svg>
                            Apply Coupon
                        </span>
                    </button>
                    <div id="monthly-coupon-result" class="mt-2 sm:mt-3"></div>
                </div>
                
                <button onclick="initiatePayment('monthly')" class="group/btn relative w-full px-6 sm:px-8 py-3 sm:py-4 rounded-xl bg-gradient-to-r from-blue-600 to-blue-500 text-white font-semibold hover:from-blue-700 hover:to-blue-600 transition-all transform hover:scale-105 hover:shadow-2xl hover:shadow-blue-500/50 text-sm sm:text-base overflow-hidden">
                    <span class="relative z-10 flex items-center justify-center gap-2">
                        Subscribe Monthly
                        <svg class="w-4 h-4 group-hover/btn:translate-x-1 transition-transform" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                            <path d="M5 12h14M12 5l7 7-7 7" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </span>
                    <div class="absolute inset-0 animate-shimmer"></div>
                </button>
            </div>
        </div>

        <!-- Yearly Plan -->
        <div class="relative overflow-hidden rounded-2xl glass-effect border-2 border-green-500/50 p-8 hover:border-green-400 transition-all hover-lift animate-scale-in group" data-plan="yearly" style="animation-delay: 0.1s;">
            <!-- Enhanced Background Glow -->
            <div class="absolute -top-24 -right-24 w-48 h-48 bg-gradient-to-r from-green-600/30 to-emerald-500/30 rounded-full blur-3xl group-hover:scale-150 transition-transform duration-700 animate-glow"></div>
            
            <div class="absolute top-4 right-4 px-3 py-1 rounded-full bg-gradient-to-r from-green-500 to-emerald-500 text-white text-sm font-semibold shadow-lg animate-pulse-border">
                <span class="flex items-center gap-1">
                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                    </svg>
                    BEST VALUE
                </span>
            </div>
            <div class="text-center relative z-10">
                <div class="inline-flex items-center gap-2 px-3 py-1 rounded-full glass-effect text-xs text-green-300 mb-3 border border-green-500/30">
                    <svg class="w-3 h-3 animate-pulse" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                    </svg>
                    <span>Most Popular</span>
                </div>
                <h3 class="text-2xl font-bold text-white mb-2 group-hover:scale-105 transition-transform">3-Month Combined Plan</h3>
                <div class="text-4xl font-bold text-green-400 mb-2 group-hover:scale-110 transition-transform" style="filter: drop-shadow(0 0 10px rgba(34, 197, 94, 0.5));">â‚¹799<span class="text-lg text-slate-400">/3 months</span></div>
                <p class="text-green-400 font-semibold mb-6 flex items-center justify-center gap-2">
                    <svg class="w-5 h-5 animate-pulse" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M8.433 7.418c.155-.103.346-.196.567-.267v1.698a2.305 2.305 0 01-.567-.267C8.07 8.34 8 8.114 8 8c0-.114.07-.34.433-.582zM11 12.849v-1.698c.22.071.412.164.567.267.364.243.433.468.433.582 0 .114-.07.34-.433.582a2.305 2.305 0 01-.567.267z"/>
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-13a1 1 0 10-2 0v.092a4.535 4.535 0 00-1.676.662C6.602 6.234 6 7.009 6 8c0 .99.602 1.765 1.324 2.246.48.32 1.054.545 1.676.662v1.941c-.391-.127-.68-.317-.843-.504a1 1 0 10-1.51 1.31c.562.649 1.413 1.076 2.353 1.253V15a1 1 0 102 0v-.092a4.535 4.535 0 001.676-.662C13.398 13.766 14 12.991 14 12c0-.99-.602-1.765-1.324-2.246A4.535 4.535 0 0011 9.092V7.151c.391.127.68.317.843.504a1 1 0 101.511-1.31c-.563-.649-1.413-1.076-2.354-1.253V5z" clip-rule="evenodd"/>
                    </svg>
                    Save â‚¹100!
                </p>
                
                <ul class="text-left space-y-3 mb-8">
                    <li class="flex items-center gap-3 text-slate-300">
                        <svg class="w-5 h-5 text-green-400" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                        </svg>
                        All Trading Calculators
                    </li>
                    <li class="flex items-center gap-3 text-slate-300">
                        <svg class="w-5 h-5 text-green-400" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                        </svg>
                        Position Management & Risk Analysis
                    </li>
                    <li class="flex items-center gap-3 text-slate-300">
                        <svg class="w-5 h-5 text-green-400" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                        </svg>
                        Trade Journal & Analytics
                    </li>
                    <li class="flex items-center gap-3 text-slate-300">
                        <svg class="w-5 h-5 text-green-400" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                        </svg>
                        Real-time Market Data
                    </li>
                    <li class="flex items-center gap-3 text-slate-300">
                        <svg class="w-5 h-5 text-green-400" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                        </svg>
                        Priority Support
                    </li>
                    <li class="flex items-center gap-3 text-slate-300">
                        <svg class="w-5 h-5 text-green-400" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                        </svg>
                        Advanced Analytics & AI Assistant
                    </li>
                    <li class="flex items-center gap-3 text-slate-300">
                        <svg class="w-5 h-5 text-green-400" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                        </svg>
                        Custom Strategies & Broker Connection
                    </li>
                </ul>
                
                <div class="mb-6">
                    <div class="relative">
                        <input type="text" id="yearly-coupon" class="w-full px-4 py-3 rounded-lg glass-effect border border-slate-600 text-white placeholder-slate-400 focus:border-green-500 focus:outline-none focus:ring-2 focus:ring-green-500/50 transition-all" placeholder="Enter coupon code (optional)">
                        <svg class="absolute right-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-slate-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 5v2m0 4v2m0 4v2M5 5a2 2 0 00-2 2v3a2 2 0 110 4v3a2 2 0 002 2h14a2 2 0 002-2v-3a2 2 0 110-4V7a2 2 0 00-2-2H5z"/>
                        </svg>
                    </div>
                    <button type="button" class="mt-3 px-4 py-2 rounded-lg glass-effect text-slate-300 hover:bg-green-500/20 hover:text-green-300 hover:border-green-500/50 transition-all border border-slate-600" onclick="applyCoupon('yearly')">
                        <span class="flex items-center gap-2">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                            </svg>
                            Apply Coupon
                        </span>
                    </button>
                    <div id="yearly-coupon-result" class="mt-3"></div>
                </div>
                
                <button onclick="initiatePayment('yearly')" class="group/btn relative w-full px-8 py-4 rounded-xl bg-gradient-to-r from-green-600 to-green-500 text-white font-semibold hover:from-green-700 hover:to-green-600 transition-all transform hover:scale-105 hover:shadow-2xl hover:shadow-green-500/50 overflow-hidden">
                    <span class="relative z-10 flex items-center justify-center gap-2">
                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                        </svg>
                        Subscribe 3-Month Plan
                        <svg class="w-4 h-4 group-hover/btn:translate-x-1 transition-transform" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                            <path d="M5 12h14M12 5l7 7-7 7" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </span>
                    <div class="absolute inset-0 animate-shimmer"></div>
                </button>
            </div>
        </div>
    </div>
    {% else %}
    <div class="max-w-2xl mx-auto text-center animate-scale-in">
        <div class="glass-effect rounded-2xl p-8 border border-green-500/50 hover-lift">
            <div class="w-16 h-16 mx-auto mb-4 rounded-full bg-gradient-to-r from-green-500 to-emerald-500 flex items-center justify-center shadow-lg">
                <svg class="w-8 h-8 text-white" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                </svg>
            </div>
            <h3 class="text-2xl font-bold text-white mb-4">Manage Subscription</h3>
            <p class="text-slate-300 mb-6">Your subscription will automatically renew on {{ user.subscription_expires.strftime('%B %d, %Y') if user.subscription_expires else 'N/A' }}</p>
            <a href="{{ url_for('home') }}" class="group/btn relative inline-flex items-center gap-2 px-8 py-4 rounded-xl bg-gradient-to-r from-blue-600 to-blue-500 text-white font-semibold hover:from-blue-700 hover:to-blue-600 transition-all hover:scale-105 hover:shadow-2xl hover:shadow-blue-500/50 overflow-hidden">
                <span class="relative z-10 flex items-center gap-2">
                    Continue Using Premium
                    <svg class="w-4 h-4 group-hover/btn:translate-x-1 transition-transform" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                        <path d="M5 12h14M12 5l7 7-7 7" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </span>
                <div class="absolute inset-0 animate-shimmer"></div>
            </a>
        </div>
    </div>
    {% endif %}

    <div class="text-center mt-16 animate-fade-in-up" style="animation-delay: 0.3s;">
        <div class="inline-flex items-center gap-2 px-4 py-2 rounded-full glass-effect text-sm text-slate-400 mb-4">
            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>
            </svg>
            <span>Secure Payment â€¢ Cancel Anytime</span>
        </div>
        <p class="text-slate-400">
            <small>
                By subscribing, you agree to our 
                <a href="{{ url_for('terms') }}" target="_blank" class="text-blue-400 hover:text-blue-300 underline hover:no-underline transition-all">Terms and Conditions</a>
            </small>
        </p>
    </div>
</main>
{% endblock %}

{% block extra_js %}
<script src="https://checkout.razorpay.com/v1/checkout.js"></script>
<script>
let appliedCoupons = {};

function applyCoupon(planType) {
    const couponInput = document.getElementById(`${planType}-coupon`);
    const resultDiv = document.getElementById(`${planType}-coupon-result`);
    const couponCode = couponInput.value.trim();
    
    if (!couponCode) {
        resultDiv.innerHTML = '<div class="text-red-400 text-sm">Please enter a coupon code</div>';
        return;
    }
    
    resultDiv.innerHTML = '<div class="text-blue-400 text-sm">Validating coupon...</div>';
    
    fetch('/api/apply-coupon', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({ 
            coupon_code: couponCode,
            plan_type: planType
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            appliedCoupons[planType] = data;
            const savings = (data.discount_amount / 100).toFixed(2);
            const finalAmount = (data.final_amount / 100).toFixed(2);
            resultDiv.innerHTML = `
                <div class="text-green-400 text-sm">
                    <strong>Coupon Applied!</strong><br>
                    Discount: ${data.discount_percent}% (â‚¹${savings} off)<br>
                    Final Amount: â‚¹${finalAmount}
                </div>
            `;
            
            updatePriceDisplay(planType, data.final_amount, data.discount_amount);
        } else {
            resultDiv.innerHTML = `<div class="text-red-400 text-sm">${data.error}</div>`;
            delete appliedCoupons[planType];
            resetPriceDisplay(planType);
        }
    })
    .catch(error => {
        console.error('Error:', error);
        resultDiv.innerHTML = '<div class="text-red-400 text-sm">Failed to validate coupon</div>';
        delete appliedCoupons[planType];
        resetPriceDisplay(planType);
    });
}

function updatePriceDisplay(planType, finalAmount, discountAmount) {
    const priceElement = document.querySelector(`[data-plan="${planType}"] .text-4xl`);
    if (priceElement) {
        const finalPrice = (finalAmount / 100).toFixed(0);
        const originalPrice = planType === 'monthly' ? '300' : '799';
        const period = planType === 'monthly' ? 'month' : '3 months';
        priceElement.innerHTML = `
            <span style="text-decoration: line-through; color: #64748b; font-size: 0.7em;">â‚¹${originalPrice}</span><br>
            â‚¹${finalPrice}<span class="text-lg text-slate-400">/${period}</span>
        `;
    }
}

function resetPriceDisplay(planType) {
    const priceElement = document.querySelector(`[data-plan="${planType}"] .text-4xl`);
    if (priceElement) {
        const price = planType === 'monthly' ? '300' : '799';
        const period = planType === 'monthly' ? 'month' : '3 months';
        const colorClass = planType === 'monthly' ? 'text-blue-400' : 'text-green-400';
        priceElement.className = `text-4xl font-bold ${colorClass} mb-6`;
        priceElement.innerHTML = `â‚¹${price}<span class="text-lg text-slate-400">/${period}</span>`;
    }
}

function initiatePayment(planType) {
    const couponCode = appliedCoupons[planType] ? appliedCoupons[planType].coupon_code : null;
    
    const requestData = { plan_type: planType };
    if (couponCode) {
        requestData.coupon_code = couponCode;
    }
    
    fetch('/create_order', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(requestData)
    })
    .then(response => response.json())
    .then(data => {
        if (data.error) {
            alert('Error: ' + data.error);
            return;
        }
        
        const options = {
            key: data.key,
            amount: data.amount,
            currency: data.currency,
            name: 'CalculatenTrade',
            description: `${planType.charAt(0).toUpperCase() + planType.slice(1)} Subscription`,
            order_id: data.order_id,
            handler: function(response) {
                verifyPayment(response);
            },
            prefill: {
                name: '{{ current_user.name or "" }}',
                email: '{{ current_user.email }}'
            },
            theme: {
                color: '#007bff'
            }
        };
        
        const rzp = new Razorpay(options);
        rzp.open();
    })
    .catch(error => {
        console.error('Error:', error);
        alert('Payment initialization failed');
    });
}

function verifyPayment(response) {
    fetch('/verify_payment', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            razorpay_payment_id: response.razorpay_payment_id,
            razorpay_order_id: response.razorpay_order_id,
            razorpay_signature: response.razorpay_signature
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.status === 'success') {
            alert(data.message);
            window.location.reload();
        } else {
            alert('Payment verification failed: ' + data.error);
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('Payment verification failed');
    });
}

document.addEventListener('DOMContentLoaded', function() {
    const urlParams = new URLSearchParams(window.location.search);
    const couponCode = urlParams.get('coupon');
    const autoApply = urlParams.get('auto_apply');
    
    if (couponCode && autoApply === 'true') {
        showCouponWelcomeMessage(couponCode);
        
        document.getElementById('monthly-coupon').value = couponCode;
        document.getElementById('yearly-coupon').value = couponCode;
        
        setTimeout(() => {
            applyCoupon('monthly');
            applyCoupon('yearly');
        }, 500);
    }
});

function showCouponWelcomeMessage(couponCode) {
    const welcomeDiv = document.createElement('div');
    welcomeDiv.className = 'glass-effect border border-green-500/50 text-green-300 p-4 sm:p-6 rounded-xl mb-8 animate-scale-in hover-lift';
    welcomeDiv.innerHTML = `
        <div class="flex items-center gap-3 mb-3">
            <div class="w-10 h-10 rounded-full bg-gradient-to-r from-green-500 to-emerald-500 flex items-center justify-center shadow-lg animate-pulse">
                <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M4 4a2 2 0 00-2 2v1h16V6a2 2 0 00-2-2H4zM18 9H2v5a2 2 0 002 2h12a2 2 0 002-2V9zM4 13a1 1 0 011-1h1a1 1 0 110 2H5a1 1 0 01-1-1zm5-1a1 1 0 100 2h1a1 1 0 100-2H9z"/>
                </svg>
            </div>
            <h5 class="font-semibold text-lg">Welcome! Coupon Applied ðŸŽ‰</h5>
        </div>
        <p class="text-sm text-slate-300">Your coupon code <strong class="text-green-400 font-mono bg-green-500/20 px-2 py-1 rounded">${couponCode}</strong> has been automatically applied to both plans. Choose your preferred subscription below!</p>
    `;
    
    const container = document.querySelector('main');
    const firstChild = container.children[1];
    container.insertBefore(welcomeDiv, firstChild);
}
</script>
{% endblock %}